---

## Цель

Добавить поддержку **модификаторов рецептов**, где ограничение по машине реализуется ** через programmed_circuit**.

---

## Термины

* **modifier** строка тег, например `circuit:5`
* **recipe.modifiers** требования рецепта
* **machine.modifiers** доступные модификаторы машины
* **programmed_circuit** единственный динамический модификатор

---

## 1. Где задаются модификаторы

### Рецепт

Файл: `Recipe.lua`

* Поле: `spec.modifiers`
* Тип: список строк
* В `Recipe:init` список преобразуется в set `recipe.modifiers`
* Если `modifiers` отсутствует, ограничений нет

Допустимый формат модификаторов:

* `"circuit:N"` где `N` номер схемы


---


### Машина GTCEu. Динамические модификаторы

Файл: `GtceuMachine.lua`

Логика `getDynamicModifiers()`:

1. Сканируются слоты:

   * если в конфиге есть `modifierSlots`, использовать только их
   * иначе сканировать все слоты

2. Для каждого предмета:

   * если предмет является programmed circuit
   * извлечь номер схемы из map NBT hash 

     * если номер найден, добавить `circuit:N`


---

## 2. Как используется при планировании

Файл: `MachineScheduler.lua`

* При выборе машины вызывается:

  ```
  machine:canAcceptTasks(task)
  ```

---

### Базовая проверка

Файл: `Machine.lua`

Метод `canAcceptTasks`:

* Проверяет, что **все** `recipe.modifiers`
* присутствуют в `self.modifiers`

---

### GTCEu расширение

Файл: `GtceuMachine.lua`

`canAcceptTasks` расширяет логику:

1. Собирает итоговый набор модификаторов:

   * динамические из `getDynamicModifiers()`

2. Проверяет:

   * что каждый `recipe.modifier` есть в итоговом наборе
   * дополнительные проверки машины:


---

## 3. Итоговая логика

* Если у рецепта **нет modifiers**, он подходит для любой машины нужного типа без modifiers
* Если modifiers есть:

  * машина обязана иметь требуемый `circuit` модификатор
  * номер схемы учитывается строго

Поддерживается только:

* `circuit:N`

---

## Мини пример

### Рецепт

```json
{
  "modifiers": ["circuit:5"]
}
```

### Подходит только если

* В машине установлен programmed circuit
* хеш NBT схемы установлен номер `5`

Если номер другой или схемы нет, рецепт не может быть назначен.

